<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Alex Fennell" />
    
    
    <title>Weight Training Classification</title>

        <script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
        <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="site_libs/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="site_libs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="site_libs/navigation-1.1/tabsets.js"></script>
        <link href="site_libs/downcute-0.1/downcute.css" rel="stylesheet" />
        <link href="site_libs/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
        <script src="site_libs/downcute-0.1/downcute_styles.js"></script>
        <script src="site_libs/downcute-0.1/downcute.js"></script>
        <script src="site_libs/prism-1.22/prism.js"></script>
    
    
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
               <!-- downcute start -->   
   <div id="docute" class="Root theme-default">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            <ul>
            <li><a href="#synopsis">Synopsis</a></li>
            <li><a href="#read-in-the-data">Read in the Data</a></li>
            <li><a href="#assessing-missing-data">Assessing missing
            data</a>
            <ul>
            <li><a href="#removing-missing-values">Removing Missing
            Values</a></li>
            <li><a href="#keeping-accelerometer-data">Keeping
            accelerometer data</a></li>
            <li><a href="#correlated-predictors">Correlated
            Predictors</a></li>
            <li><a href="#near-zero-variance">Near Zero
            Variance</a></li>
            <li><a href="#validation-data-split">Validation data
            split</a></li>
            </ul></li>
            <li><a href="#model-analysis">Model analysis</a>
            <ul>
            <li><a href="#data-preprocessing">Data
            Preprocessing</a></li>
            <li><a href="#random-forest-model-fit">Random Forest Model
            Fit</a></li>
            <li><a href="#optimal-mtry">Optimal mtry</a></li>
            <li><a href="#variable-importance">Variable
            Importance</a></li>
            <li><a href="#principal-component-analysis">Principal
            Component Analysis</a></li>
            </ul></li>
            <li><a href="#model-fit-evaluation">Model Fit Evaluation</a>
            <ul>
            <li><a
            href="#confusion-matrix-caret-hold-out-cross-validation-data-set">Confusion
            matrix-caret hold out cross validation data set</a></li>
            <li><a
            href="#confusion-matrix-validation-data-set">Confusion
            matrix-validation data set</a></li>
            </ul></li>
            <li><a href="#conclusion">Conclusion</a></li>
            </ul>
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle "><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
      
      <div class="navbar navbar-default  navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Weight Training Classification</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li>
        <a href="index.html">Navigation</a>
      </li>
      <li>
        <a href="README.html">README</a>
      </li>
      <li>
        <a href="Classification_script.html">Weight Training Classification</a>
      </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container -->
      </div><!--/.navbar -->
        
      <h1 class="title">Weight Training Classification</h1>
      
      <p class="authors">
           <span class="glyphicon glyphicon-user"></span> Alex Fennell
      </p>
              

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<div id="synopsis" class="section level1">
<h1>Synopsis</h1>
<p>The goal of this project is to correctly classify the quality of
physical activity an individual carried out based on accelerometer
collected from the belt, forearm, arm, and dumbbell. There were 5
different ways in which the exercise was carried out. It was done either
exactly according to the specification (Class A), throwing the elbows to
the front (Class B), lifting the dumbbell only halfway (Class C),
lowering the dumbbell only halfway (Class D) and throwing the hips to
the front (Class E). Class A is the correct manner in which the exercise
should be carried out, while the other classes are common errors. Using
the accelerometer data I was able to create a random forest model that
classified this information into the 5 desired classes with 98 percent
accuracy.</p>
<pre class="r"><code>library(Hmisc)
library(vip)
library(randomForest)
library(e1071)
library(parallel)
library(MLmetrics)
library(foreach)
library(doParallel)
library(tidytext)
library(tidyverse)
library(reshape2)
library(caret)</code></pre>
</div>
<div id="read-in-the-data" class="section level1">
<h1>Read in the Data</h1>
<pre class="r"><code>#train data location
fileurl&lt;-&quot;https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv&quot;
if (!file.exists(&quot;fittrain.csv&quot;)){
    download.file(fileurl,&quot;fittrain.csv&quot;,method=&quot;curl&quot;)
}
#test data location
fileurl&lt;-&quot;https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv&quot;
if (!file.exists(&quot;fittest.csv&quot;)){
    download.file(fileurl,&quot;fittest.csv&quot;,method=&quot;curl&quot;)
}

# The data sets had many entries that were spaces (&quot;&quot;) and thus I specified these
# to be missing values (NA)
fit_train&lt;-read.csv(&quot;fittrain.csv&quot;,na.strings = c(&quot;NA&quot;,&quot;&quot;))
fit_test&lt;-read.csv(&quot;fittest.csv&quot;,na.strings = c(&quot;NA&quot;,&quot;&quot;))</code></pre>
</div>
<div id="assessing-missing-data" class="section level1">
<h1>Assessing missing data</h1>
<p>The first thing I want to do is assess the amount of missing data, so
I know if there are certain predictors I should remove, or I should
implement an imputation technique.</p>
<pre class="r"><code>head(colSums(is.na(fit_train)),n=20)</code></pre>
<pre><code>##                    X            user_name raw_timestamp_part_1 
##                    0                    0                    0 
## raw_timestamp_part_2       cvtd_timestamp           new_window 
##                    0                    0                    0 
##           num_window            roll_belt           pitch_belt 
##                    0                    0                    0 
##             yaw_belt     total_accel_belt   kurtosis_roll_belt 
##                    0                    0                19216 
##  kurtosis_picth_belt    kurtosis_yaw_belt   skewness_roll_belt 
##                19216                19216                19216 
## skewness_roll_belt.1    skewness_yaw_belt        max_roll_belt 
##                19216                19216                19216 
##       max_picth_belt         max_yaw_belt 
##                19216                19216</code></pre>
<p>Given a good number of these predictors are columns of missing
values, I will go ahead and remove any predictor that is more than 95%
missing values.</p>
<div id="removing-missing-values" class="section level2">
<h2>Removing Missing Values</h2>
<pre class="r"><code>threshold=.95
trainfilt&lt;-fit_train[,colSums(is.na(fit_train))&lt;(nrow(fit_train)*threshold)]
testfilt&lt;-fit_test[,colSums(is.na(fit_test))&lt;(nrow(fit_test)*threshold)]</code></pre>
</div>
<div id="keeping-accelerometer-data" class="section level2">
<h2>Keeping accelerometer data</h2>
<p>I am only using data from the accelerometers, as I am interested in
assessing whether the acelerometers alone are enough to classify the
quality with which an exercise is carried out. As a result, I will
remove columns that contain other information.</p>
<pre class="r"><code>trainfilt&lt;-trainfilt[,-c(1,2,3,4,5,6,7)]
testfilt&lt;-testfilt[,-c(1,2,3,4,5,6,7)]

trainfilt$classe&lt;-as.factor(trainfilt$classe)
testfilt$classe&lt;-as.factor(testfilt$classe)</code></pre>
</div>
<div id="correlated-predictors" class="section level2">
<h2>Correlated Predictors</h2>
<p>The next step in understanding the data is to look at correlations
among the predictors. If variables are highly related to each other, it
may be worthwhile to remove them or do some dimensionality reduction
such as PCA. I use a correlation threshold of .75 here so as to only
examine the most highly correlated predictors.</p>
<pre class="r"><code>cormat&lt;-trainfilt%&gt;%
    select_if(is.numeric)%&gt;%
    as.matrix()%&gt;%
    rcorr(type=&#39;pearson&#39;)
highcor&lt;-findCorrelation(cormat$r,cutoff = 0.75)
colnames(cormat$r[highcor,highcor])</code></pre>
<pre><code>##  [1] &quot;accel_belt_z&quot;      &quot;roll_belt&quot;         &quot;accel_belt_y&quot;     
##  [4] &quot;accel_arm_y&quot;       &quot;total_accel_belt&quot;  &quot;accel_dumbbell_z&quot; 
##  [7] &quot;accel_belt_x&quot;      &quot;pitch_belt&quot;        &quot;magnet_dumbbell_x&quot;
## [10] &quot;accel_dumbbell_y&quot;  &quot;magnet_dumbbell_y&quot; &quot;accel_arm_x&quot;      
## [13] &quot;accel_dumbbell_x&quot;  &quot;accel_arm_z&quot;       &quot;magnet_arm_y&quot;     
## [16] &quot;magnet_belt_z&quot;     &quot;accel_forearm_y&quot;   &quot;gyros_forearm_y&quot;  
## [19] &quot;gyros_dumbbell_x&quot;  &quot;gyros_dumbbell_z&quot;  &quot;gyros_arm_x&quot;</code></pre>
<p>It is not surprising that there are many correlated predictors given
that these are complex movements that require coordination from many
parts of the body. Given this, it seems inappropriate to remove
variables. Therefore I will go forward with a PCA technique in order to
reduce the dimensionality of the data while still retaining the most
informative aspects of the data.</p>
</div>
<div id="near-zero-variance" class="section level2">
<h2>Near Zero Variance</h2>
<p>Next I will examine the data set to determine if there are any
uninformative predictors and remove them if that is the case.</p>
<pre class="r"><code>nzv&lt;-nearZeroVar(trainfilt,saveMetrics = TRUE)
data.frame(zeroVar=sum(nzv$zeroVar==TRUE), NZV=sum(nzv$nzv==TRUE))</code></pre>
<pre><code>##   zeroVar NZV
## 1       0   0</code></pre>
<p>There are no uninformative predictors, so the data is ready for
modelling.</p>
</div>
<div id="validation-data-split" class="section level2">
<h2>Validation data split</h2>
<p>Before modelling, I split the training data set to include a
validation set so the model does not overfit.</p>
<pre class="r"><code>set.seed(1234)
samp&lt;-createDataPartition(y=trainfilt$classe,p=.8,list = FALSE)
training&lt;-trainfilt[samp,]
validation&lt;-trainfilt[-samp,]</code></pre>
</div>
</div>
<div id="model-analysis" class="section level1">
<h1>Model analysis</h1>
<p>The model I am going to use is a random forest model since these
typically have superior performance when it comes to classification. I
am using a repeated cross validation procedure with 10 folds, and 3
repeats to get a stable model that minimizes overtraining. I will do a
grid search to find the optimal value for the mtry parameter. This
parameter corresponds to the number of variables randomly sampled as
candidates at each split. I center and scale all the predictors and then
do a pca selecting the components that account for 95% of the variance.
I use a tree size of 250 as this is enough to produce stable accuracy
and is not overly computationally intensive. Model performance will be
assessed on its accuracy.</p>
<div id="data-preprocessing" class="section level2">
<h2>Data Preprocessing</h2>
<pre class="r"><code>control&lt;-trainControl(method=&#39;repeatedcv&#39;,
                      number=10,
                      repeats = 3,
                      classProbs = TRUE,
                      summaryFunction = multiClassSummary,
                      allowParallel = TRUE,
                      savePredictions = TRUE,
                      search=&#39;grid&#39;,
                      verboseIter = TRUE)
tunevals&lt;-expand.grid(.mtry=c(1:10))
#preprocess all datasets
trainpre&lt;-preProcess(training,method=c(&#39;center&#39;,&#39;scale&#39;,&#39;pca&#39;),thresh=.95)
trainpca&lt;-predict(trainpre,training)
valpca&lt;-predict(trainpre,validation)
testpca&lt;-predict(trainpre,testfilt)</code></pre>
</div>
<div id="random-forest-model-fit" class="section level2">
<h2>Random Forest Model Fit</h2>
<pre class="r"><code>#Parallelize the random forest process
cluster&lt;-makeCluster(detectCores()-6) 
registerDoParallel(cluster)
set.seed(1234)
    rfmod&lt;-train(classe~.,
                 data=trainpca,
                 method=&#39;rf&#39;,
                 ntree=250,
                 tuneGrid=tunevals,
                 verbose=TRUE,
                 metric=&#39;Accuracy&#39;,
                 trControl=control)

stopCluster(cluster)
registerDoSEQ()</code></pre>
</div>
<div id="optimal-mtry" class="section level2">
<h2>Optimal mtry</h2>
<p>This plot shows how the mtry value affects the cross validation
accuracy for the model.</p>
<pre class="r"><code>plot(rfmod)</code></pre>
<p><img src="Classification_script_files/figure-html/plot%20of%20parameter%20optimization-1.png" width="768" /></p>
<p>This plot shows that an mtry value of 3 results in the highest
accuracy on the held out cross validation sets.</p>
</div>
<div id="variable-importance" class="section level2">
<h2>Variable Importance</h2>
<p>Using the vip plot we can assess what the most valuable predictors
are.</p>
<pre class="r"><code>vip(rfmod)</code></pre>
<p><img src="Classification_script_files/figure-html/vip%20plot-1.png" width="768" /></p>
<p>The most important predictor appears to be PC8, so let’s examine that
to see what this component is capturing.</p>
</div>
<div id="principal-component-analysis" class="section level2">
<h2>Principal Component Analysis</h2>
<pre class="r"><code># Extract the pca loadings into an objects that will work with ggplot2
traincomp&lt;-melt(trainpre$rotation)
colnames(traincomp)&lt;-c(&quot;Original_Var&quot;,&quot;Component&quot;,&quot;Magnitude&quot;)

pcaplot&lt;-traincomp %&gt;%
  filter(Component %in% paste0(&quot;PC&quot;, c(8,14,12,1,5))) %&gt;%
  ggplot(aes(Magnitude, Original_Var, fill = Original_Var)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~Component, nrow = 1) +
  labs(y = NULL,
       x=&quot;Strength of Contribution&quot;)
pcaplot</code></pre>
<p><img src="Classification_script_files/figure-html/pca%20plot-1.png" width="864" /></p>
<p>This figure shows the five most informative principal components and
the contributions of each predictor into each principal component. Since
each component is influenced in some way by each predictor, one way to
understand what a component is capturing is by examining the tallest
bars in the plot to see what predictors are contributing the most to
each component. For example in PC 14 gyroscopic information from the
belt in the z and y planes are the largest contributors. Given that one
of the classes of exercises involved movement of the hips it makes sense
this component would be useful for classification. The following plot
shows the most informative predictors that contribute to these
components to provide a clearer picture of what these components are
capturing.</p>
<pre class="r"><code>pcaplot2&lt;-traincomp %&gt;%
    filter(Component %in% paste0(&quot;PC&quot;, c(8,14,12,1,5))) %&gt;%
    group_by(Component) %&gt;%
    top_n(8, abs(Magnitude)) %&gt;%
    ungroup() %&gt;%
    mutate(Original_Var = reorder_within(Original_Var, abs(Magnitude), Component)) %&gt;%
    ggplot(aes(abs(Magnitude), Original_Var, fill = Magnitude)) +
    geom_col() +
    scale_fill_viridis_c() +
    facet_wrap(~Component, scales = &quot;free_y&quot;) +
    scale_y_reordered() +
    labs(
         title=&quot;Predictor Contribution  to  Top Five Principal Components&quot;,
        x = &quot;Absolute value of contribution&quot;,
        y = NULL, fill = &quot;Strength of \nContribution&quot;
     ) +
    theme(plot.title=element_text(hjust=.5))
pcaplot2</code></pre>
<p><img src="Classification_script_files/figure-html/Most%20significant%20predictors%20in%20components-1.png" width="960" /></p>
<p>The strongest predictors that were combined in the 5 most informative
principal components are presented in the figure above. Green and yellow
colors indicate positive values, while blue and purple colors indicate
negative values. The strongest component, PC8, is capturing gyroscopic
information from the dumbbell, and the overall acceleration in the
forearm arm and forearm in z plane, vs. overall acceleration of the arm,
in addition to the magnitude and acceleration of the forearm in the x
plane. It makes sense that this is the most important component given it
captures so much information about the dumbbell position and the
forearm. Both of these are key factors in delineating between correctly
and incorrectly carrying out the bicep curl.</p>
<pre class="r"><code>ggplot(trainpca,aes(x=PC8,y=PC14,color=classe))+
  geom_point(alpha=.3)+
  scale_color_brewer(name=&quot;Exercise Type&quot;,
                        labels=c(&quot;Correct (A)&quot;,&quot;Elbows Front (B)&quot;,&quot;Half Curl Lift (C)&quot;,
                                 &quot;Half Curl Lower (D)&quot;,&quot;Hips Front (E)&quot;),
                     type=&quot;qual&quot;,palette = &quot;Dark2&quot;)</code></pre>
<p><img src="Classification_script_files/figure-html/PCA%20components%20together-1.png" width="768" /></p>
<p>This plot is another way to demonstrate what the two most important
principal components are capturing. Since there are so many components
and many outcome categories, there are no explicit cutoffs where one
component perfectly captures one exercise type. Instead there is a much
more complex interaction among the components. PC14 does a relatively
good job of capturing some component of exercises where the hips move
forward, and the lowering of the dumbbell from halfway. Since PC14 is
mainly dominated by gyroscopic information from the belt it makes sense
that it would be better at classifying these two types of activities. In
the next section I will examine the quality of the model fits.</p>
</div>
</div>
<div id="model-fit-evaluation" class="section level1">
<h1>Model Fit Evaluation</h1>
<div id="confusion-matrix-caret-hold-out-cross-validation-data-set"
class="section level2">
<h2>Confusion matrix-caret hold out cross validation data set</h2>
<p>To assess the model fit I will be using confusion matrices. First I
will examine the model fit to the held out re-samples in the caret cross
validation procedure. Then I will examine the model performance against
the validation set that I set aside before beginning the modelling.</p>
<pre class="r"><code>confusionMatrix(rfmod)</code></pre>
<pre><code>## Cross-Validated (10 fold, repeated 3 times) Confusion Matrix 
## 
## (entries are percentual average cell counts across resamples)
##  
##           Reference
## Prediction    A    B    C    D    E
##          A 28.2  0.3  0.1  0.0  0.0
##          B  0.1 18.8  0.2  0.0  0.1
##          C  0.1  0.2 17.0  0.7  0.2
##          D  0.0  0.0  0.2 15.6  0.1
##          E  0.0  0.0  0.0  0.0 18.0
##                             
##  Accuracy (average) : 0.9767</code></pre>
<p>On the cross validation set within the caret procedure, the model is
quite accurate (~97%) with few observations off the diagonals.</p>
</div>
<div id="confusion-matrix-validation-data-set" class="section level2">
<h2>Confusion matrix-validation data set</h2>
<pre class="r"><code>confusionMatrix(predict(rfmod,valpca),valpca$classe)</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction    A    B    C    D    E
##          A 1111   10    1    1    0
##          B    1  744   12    0    0
##          C    2    4  657   25    7
##          D    2    0   12  617    6
##          E    0    1    2    0  708
## 
## Overall Statistics
##                                          
##                Accuracy : 0.9781         
##                  95% CI : (0.973, 0.9824)
##     No Information Rate : 0.2845         
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
##                                          
##                   Kappa : 0.9723         
##                                          
##  Mcnemar&#39;s Test P-Value : NA             
## 
## Statistics by Class:
## 
##                      Class: A Class: B Class: C Class: D Class: E
## Sensitivity            0.9955   0.9802   0.9605   0.9596   0.9820
## Specificity            0.9957   0.9959   0.9883   0.9939   0.9991
## Pos Pred Value         0.9893   0.9828   0.9453   0.9686   0.9958
## Neg Pred Value         0.9982   0.9953   0.9916   0.9921   0.9960
## Prevalence             0.2845   0.1935   0.1744   0.1639   0.1838
## Detection Rate         0.2832   0.1897   0.1675   0.1573   0.1805
## Detection Prevalence   0.2863   0.1930   0.1772   0.1624   0.1812
## Balanced Accuracy      0.9956   0.9881   0.9744   0.9767   0.9905</code></pre>
<p>On the validation dataset the model performs fantastic. The model
still achieves ~98% accuracy with few observations off the diagonal. The
sensitivity of the model is quite high across all classes with .96 being
the lowest. Specificity is .99 across all classes. Thus, the model is
achieving high accuracy across all classes and is not suffering in its
ability to classify one movement over another.</p>
<pre class="r"><code>rfpred&lt;-predict(rfmod,testpca)
# Calculate accuracy on the test set
sum(rfpred==testfilt$classe)/nrow(testfilt)*100</code></pre>
<pre><code>## [1] 100</code></pre>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>With the validation set the model performs very well with an accuracy
of ~98%. Thus the model has an out of sample error of 2 percent. Given
the small size of the test set, the model performs with 100 percent
accuracy. Thus this accelerometer data serves as an excellent source of
information to classify the quality of an exercise.</p>
</div>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
